(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{"16c1":function(e,t,s){},"2a5f":function(e,t,s){"use strict";s("16c1")},4749:function(e,t,s){"use strict";s("d8f3")},"487b":function(e,t,s){},"6fa8":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"page-user-access"},[t("portal",{attrs:{to:"app-breadcrumbs"}},[t("breadcrumbs")],1),t("portal",{attrs:{to:"app-toolbar"}},[t("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"menu"},on:{click:function(t){return e.$store.dispatch("app/toggleSidebar")}}}),t("q-toolbar-title",[e._v("\n      "+e._s(e.$t("User Access"))+"\n    ")])],1),t("div",{staticClass:"page-header"},[t("q-toolbar-title",[e._v(e._s(e.$t("User Access")))])],1),t("div",{staticClass:"page-body"},[t("div",{staticClass:"row q-col-gutter-lg"},[t("div",{staticClass:"col-xs-12 col-md-3"},[t("q-card",{staticClass:"q-mx-auto",attrs:{outlined:""}},[t("role-list",{attrs:{"roles:fetched":e.rolesFetched=!0},on:{selected:e.onRoleSelected}})],1)],1),t("div",{staticClass:"col-xs-12 col-md-7 col-lg-5"},[t("q-card",{staticClass:"mx-auto",attrs:{outlined:""}},[t("permission-list",{attrs:{role:e.selectedRole},on:{"permissions:fetched":function(t){e.permissionFetched=!0}}})],1)],1)])])],1)},n=[],r=(s("b0c0"),s("a4d3"),s("e01a"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"q-pb-md role-list"},[t("q-toolbar",{attrs:{flat:"",dense:""}},[t("q-toolbar-title",[e._v(e._s(e.$t("Role")))]),t("q-space"),e.$auth.can("create.role")?t("q-btn",{staticClass:"btn-role-list-create",attrs:{flat:"",padding:"xs"},on:{click:e.onRoleCreate}},[t("q-icon",{attrs:{name:"add"}})],1):e._e()],1),t("q-list",e._l(e.roles,(function(s){return t("q-item",{key:s.id,attrs:{clickable:"",disable:!e.$auth.can("edit.permission"),active:e.selectedRoleId&&e.selectedRoleId===s.id},on:{click:function(t){e.selectedRoleId=s.id}}},[t("q-item-section",[t("q-item-label",[e._v(e._s(s.name))]),t("q-item-label",{attrs:{caption:""}},[e._v(e._s(s.description))])],1),e.$auth.can("edit.role")?t("q-item-section",{attrs:{side:""}},[t("q-btn",{staticClass:"gt-xs btn-role-list-edit",attrs:{size:"12px",flat:"",dense:"",round:"",icon:"edit"},on:{click:function(t){return t.preventDefault(),e.onRoleEdit(s)}}})],1):e._e()],1)})),1),t("q-dialog",{attrs:{"hide-overlay":"",transition:"dialog-bottom-transition",scrollable:"",persistent:"","max-width":"600px"},model:{value:e.isDialogRoleVisible,callback:function(t){e.isDialogRoleVisible=t},expression:"isDialogRoleVisible"}},[t("form-role",{attrs:{entry:e.formRole,loading:e.isLoading},on:{cancel:e.onRoleCancel,success:e.onRoleSuccess,deleted:e.onRoleDeleted}})],1)],1)}),i=[],o=s("7ec2"),c=s.n(o),l=s("c973"),d=s.n(l),u=(s("7db0"),s("d3b7"),function(){var e=this,t=e._self._c;return t("q-card",{staticClass:"form-entry q-pa-sm",class:{readonly:e.readonly}},[t("q-form",{ref:"form",staticClass:"q-gutter-md",attrs:{greedy:""},on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[e.readonly?e._e():t("div",{staticClass:"text-h6 q-px-md q-pt-sm"},[e._v("\n      "+e._s(e.$t("".concat(e.isCreate?"Create":"Update"," {entity}"),{entity:e.$t("Role")}))+"\n    ")]),t("q-card-section",{staticClass:"q-mb-md"},[t("div",{staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12"},[t("q-input",{attrs:{label:e.$t("Name")+"*",filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,name:"name",dense:"",rules:e.rules.name,error:!!e.errors.name,"error-message":e.errors.name},model:{value:e.formEntry.name,callback:function(t){e.$set(e.formEntry,"name",t)},expression:"formEntry.name"}})],1),t("div",{staticClass:"col-xs-12"},[t("q-input",{attrs:{label:e.$t("Description"),filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,name:"description",dense:"",rules:e.rules.description,error:!!e.errors.description,"error-message":e.errors.description},model:{value:e.formEntry.description,callback:function(t){e.$set(e.formEntry,"description",t)},expression:"formEntry.description"}})],1),e.readonly?[t("div",{staticClass:"col-xs-12"},[t("q-input",{attrs:{value:e.formEntry.created_at,label:e.$t("Created At"),borderless:"",readonly:"",dense:""}})],1),t("div",{staticClass:"col-xs-12"},[t("q-input",{attrs:{value:e.formEntry.updated_at,label:e.$t("Updated At"),borderless:"",readonly:"",dense:""}})],1)]:e._e()],2)]),t("q-separator"),e.readonly?t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{attrs:{label:e.$t("Close"),flat:"",disable:e.loading||e.isLoading},on:{click:e.cancel}})],1):t("q-card-actions",{attrs:{align:"right"}},[e.isCreate||e.entry.id===e.$constant.role.TYPE_SUPER_ADMIN?e._e():t("q-btn",{staticClass:"q-mr-auto",attrs:{color:"red darken-1",flat:"",label:e.$t("Delete"),disable:e.loading},on:{click:e.onDelete}}),t("q-btn",{attrs:{label:e.$t("Cancel"),flat:"",disable:e.loading||e.isLoading},on:{click:e.cancel}}),t("q-btn",{staticClass:"q-px-lg",attrs:{type:"submit",label:e.$t("".concat(e.isCreate?"Create":"Save")),color:e.isCreate?"positive":"primary",loading:e.loading||e.isLoading,unelevated:""}})],1)],1)],1)}),m=[],f=s("ded3"),p=s.n(f),b=(s("cb29"),s("bd4c")),h={name:null,description:null,status:1},v={name:"FormEntry",props:{loading:Boolean,closable:{type:Boolean,default:!0},entry:{type:Object,default:function(){return h}},readonly:{type:Boolean,default:!1}},data:function(){var e=this;return{formEntry:h,isLoading:!1,rules:{name:[function(t){return!!t||e.$t("{field} is required",{field:e.$t("Name")})}],description:[]},errors:h}},computed:{isCreate:function(){return!this.formEntry.id}},watch:{entry:{immediate:!0,handler:function(e){var t=this;this.$nextTick((function(){t.fill(e)}))}}},methods:{fill:function(e){e=p()(p()({},h),e),e.created_at&&(e.created_at=b["b"].formatDate(e.created_at,"DD MMM YYYY HH:mm")),e.status=Boolean(parseInt(e.status,10)),this.formEntry=e,this.$refs.form.resetValidation()},onSubmit:function(){var e=this;return d()(c()().mark((function t(){var s,a,n,r,i,o;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loading&&!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:if(!e.readonly){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$refs.form.validate();case 6:if(s=t.sent,s){t.next=9;break}return t.abrupt("return");case 9:return a=p()({},e.formEntry),a.status=a.status?1:0,e.isLoading=!0,t.prev=12,n=a.id?"/v1/user-access/roles/".concat(a.id):"/v1/user-access/roles",r=a.id?"patch":"post",t.next=17,e.$api[r](n,a);case 17:i=t.sent,o=i.data,"success"===o.status&&e.$emit("success"),o.message?e.$q.notify({message:o.message}):"success"===o.status?e.$q.notify({message:e.$t("{entity} saved",{entity:e.$t("Role")})}):e.$t("Failed to save {entity}",{entity:e.$t("role")}),t.next=26;break;case 23:t.prev=23,t.t0=t["catch"](12),t.t0.validation?e.errors=p()(p()({},h),t.t0.validation.errors):e.$q.notify(t.t0);case 26:e.isLoading=!1;case 27:case"end":return t.stop()}}),t,null,[[12,23]])})))()},cancel:function(){this.loading||this.isLoading||this.$emit("cancel")},onDelete:function(){var e=this;return d()(c()().mark((function t(){return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:e.$q.dialog({title:e.$t("Confirm"),message:e.$t("Are you sure want to delete this {entity}?",{entity:e.$t("role")}),cancel:{label:e.$t("Cancel"),color:"dark",flat:!0},ok:{label:e.$t("Yes"),color:"primary",unelevated:!0,flat:!0,class:"text-weight-bold"},persistent:!0}).onOk(d()(c()().mark((function t(){var s,a;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.delete("/v1/roles/".concat(row.id));case 3:s=t.sent,a=s.data,a.message?(e.$q.notify({message:a.message}),e.$emit("deleted",p()({},e.formEntry))):"success"===a.status?(e.$q.notify({message:e.$t("{entity} deleted",{entity:e.$t("Role")})}),e.$emit("deleted",p()({},e.formEntry))):e.$t("Failed to delete {entity}",{entity:e.$t("role")}),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$q.notify(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))).onCancel((function(){e.isLoading=!1}));case 3:case"end":return t.stop()}}),t)})))()}}},g=v,$=(s("8ed6"),s("2877")),x=s("f09f"),y=s("0378"),q=s("a370"),k=s("27f9"),R=s("eb85"),C=s("4b7e"),_=s("9c40"),w=s("eebe"),P=s.n(w),Q=Object($["a"])(g,u,m,!1,null,"1d435e94",null),L=Q.exports;P()(Q,"components",{QCard:x["a"],QForm:y["a"],QCardSection:q["a"],QInput:k["a"],QSeparator:R["a"],QCardActions:C["a"],QBtn:_["a"]});var I={name:"RoleList",components:{FormRole:L},data:function(){return{selectedRoleId:null,roles:[],formRole:{},isDialogRoleVisible:!1,isLoading:!1}},watch:{selectedRoleId:function(e,t){e!==t&&this.$emit("selected",this.roles.find((function(t){return t.id===e})))}},mounted:function(){var e=this;return d()(c()().mark((function t(){return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.onRequest();case 2:e.$nextTick((function(){for(var t=0;t<e.roles.length;t++){e.selectedRoleId=e.roles[t].id;break}}));case 3:case"end":return t.stop()}}),t)})))()},methods:{onRequest:function(){var e=this;return d()(c()().mark((function t(){var s,a,n;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.get("/v1/user-access/roles");case 3:s=t.sent,a=s.data,"success"===a.status?(e.$constant.role.TYPE_SUPER_ADMIN,e.roles=a.data.roles,e.$emit("roles:fetched",a.data.roles)):e.$q.notify({message:a.message||"Failed to fetch roles"}),t.next=13;break;case 8:t.prev=8,t.t0=t["catch"](0),n=t.t0.message,t.t0.response&&t.t0.response.data&&t.t0.response.data.message&&(n=t.t0.response.data.message),e.$q.notify({message:n});case 13:case"end":return t.stop()}}),t,null,[[0,8]])})))()},onRoleCreate:function(){this.formRole={},this.isDialogRoleVisible=!0},onRoleEdit:function(e){this.formRole=e,this.isDialogRoleVisible=!0},onRoleCancel:function(){this.formRole={},this.isDialogRoleVisible=!1},onRoleSuccess:function(){this.formRole={},this.isDialogRoleVisible=!1,this.onRequest()},onRoleDeleted:function(){this.formRole={},this.isDialogRoleVisible=!1,this.onRequest()},onRoleSubmit:function(e){var t=this;return d()(c()().mark((function s(){var a,n,r;return c()().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!t.isLoading){s.next=2;break}return s.abrupt("return");case 2:return t.isLoading=!0,s.prev=3,s.next=6,t.$api[e.id?"patch":"post"]("user-access/role".concat(e.id?"/"+e.id:""),e);case 6:if(a=s.sent,n=a.data,"success"!==n.status){s.next=12;break}return t.isDialogRoleVisible=!1,s.next=12,t.fetchRoles();case 12:t.$snackbar({text:"success"===n.status?"Role successfully updated":"Failed to update role"}),s.next=20;break;case 15:s.prev=15,s.t0=s["catch"](3),r=s.t0.message,s.t0.response&&s.t0.response.data&&s.t0.response.data.message&&(r=s.t0.response.data.message),t.$snackbar({text:r});case 20:t.isLoading=!1;case 21:case"end":return s.stop()}}),s,null,[[3,15]])})))()},onRoleDelete:function(e){var t=this;return d()(c()().mark((function s(){var a,n;return c()().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!t.isLoading){s.next=2;break}return s.abrupt("return");case 2:return t.isLoading=!0,s.prev=3,s.next=6,t.$axios.delete("/user-access/role/".concat(e.id));case 6:if(a=s.sent,n=a.data,"success"!==n.status){s.next=12;break}return t.isDialogRoleVisible=!1,s.next=12,t.fetchRoles();case 12:n.message?t.$snackbar({text:n.message}):t.$snackbar({text:"success"===n.status?"Role successfully deleted":"Failed to delete role"}),s.next=18;break;case 15:s.prev=15,s.t0=s["catch"](3),t.$snackbar(s.t0);case 18:t.isLoading=!1;case 19:case"end":return s.stop()}}),s,null,[[3,15]])})))()}}},D=I,E=(s("75ca"),s("65c6")),S=s("6ac5"),F=s("2c91"),T=s("0016"),A=s("1c1c"),V=s("66e5"),U=s("4074"),Y=s("0170"),B=s("24e8"),M=s("b498"),N=Object($["a"])(D,r,i,!1,null,null,null),G=N.exports;P()(N,"components",{QToolbar:E["a"],QToolbarTitle:S["a"],QSpace:F["a"],QBtn:_["a"],QIcon:T["a"],QList:A["a"],QItem:V["a"],QItemSection:U["a"],QItemLabel:Y["a"],QDialog:B["a"],QColor:M["a"]});s("caad");var O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"permission-list"},[t("q-toolbar",{attrs:{flat:""}},[t("q-toolbar-title",[e._v(e._s(e.$t("Permission")))]),t("q-space"),e.role?t("q-btn",{staticClass:"btn-permission-save",class:{"q-btn-lg":e.$q.screen.gt.md},attrs:{loading:e.isLoading,color:"primary"},on:{click:e.onPermissionSave}},[e._v("\n      "+e._s(e.$t("Save"))+"\n    ")]):e._e()],1),e.role?t("div",{staticClass:"q-pt-lg q-pl-lg"},e._l(e.permissions,(function(s,a){return t("div",{key:a,staticClass:"row"},[t("div",{staticClass:"col-xs-12"},[t("q-card",{staticClass:"mx-auto",attrs:{"max-width":"475",flat:""}},[t("q-card-section",[t("q-list",{attrs:{flat:""}},[t("q-item-label",{staticClass:"group-label"},[e._v(e._s(e.$t(a)))]),e._l(s,(function(s){return t("q-item",{key:s.id,class:"btn-permission-item-".concat(s.id),attrs:{clickable:"",disable:e.role==e.$constant.role.TYPE_SUPER_ADMIN&&["access.dashboard","manage.permission","edit.permission"].includes(s.key)},on:{click:function(t){return e.onPermissionClick(s.id)}}},[t("q-item-section",[t("q-item-label",[e._v(e._s(s.name))])],1),t("q-item-section",{attrs:{side:""}},[t("q-checkbox",{attrs:{val:s.id,disable:e.role==e.$constant.role.TYPE_SUPER_ADMIN&&["access.dashboard","manage.permission","edit.permission"].includes(s.key)},model:{value:e.selectedPermissionsId,callback:function(t){e.selectedPermissionsId=t},expression:"selectedPermissionsId"}})],1)],1)}))],2)],1)],1)],1)])})),0):t("q-card-section",{staticClass:"empty-permission"},[t("em",[e._v(e._s(e.$t("Please select role on the left side")))])])],1)},j=[],H=s("448a"),J=s.n(H),z=(s("a9e3"),s("2532"),s("4de4"),s("99af"),{name:"PermissionList",props:{role:{type:Number,default:null}},data:function(){return{permissions:[],roles:[],isDialogRoleVisible:!1,isLoading:!1,selectedPermissionsId:[]}},watch:{role:{deep:!0,immediate:!0,handler:function(e,t){var s=this;return d()(c()().mark((function a(){return c()().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e===t){a.next=3;break}return a.next=3,s.fetchRolePermission();case 3:case"end":return a.stop()}}),a)})))()}}},mounted:function(){this.fetchPermissions()},methods:{fetchPermissions:function(){var e=this;return d()(c()().mark((function t(){var s,a;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.get("/v1/user-access/permissions");case 3:s=t.sent,a=s.data,"success"===a.status?(e.permissions=a.data.permissions,e.$emit("permissions:fetched",a.data.permissions)):e.$q.notify({message:a.message||"Failed to load permissions"}),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error(t.t0),e.$q.notify(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},fetchRolePermission:function(){var e=this;return d()(c()().mark((function t(){var s,a,n,r;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e.role,s){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,e.$api.get("/v1/user-access/permissions/".concat(s,"/role"));case 6:if(a=t.sent,n=a.data,"success"!==n.status){t.next=17;break}return e.selectedPermissionsId=n.data.permission_ids,r=p()({},e.permissions),e.permissions={},t.next=14,e.$nextTick();case 14:e.permissions=r,t.next=18;break;case 17:e.$q.notify({message:n.message||"Failed to fetch roles"});case 18:t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](3),e.$q.notify(t.t0);case 23:case"end":return t.stop()}}),t,null,[[3,20]])})))()},onPermissionClick:function(e){this.selectedPermissionsId.includes(e)?this.selectedPermissionsId=this.selectedPermissionsId.filter((function(t){return t!==e})):this.selectedPermissionsId=[].concat(J()(this.selectedPermissionsId),[e])},onPermissionSave:function(){var e=this;return d()(c()().mark((function t(){var s,a,n;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:return e.isLoading=!0,s=e.role,t.prev=4,t.next=7,e.$api.patch("/v1/user-access/permissions/".concat(s,"/role"),{permissions:e.selectedPermissionsId});case 7:a=t.sent,n=a.data,n.message?e.$q.notify({message:n.message}):e.$q.notify({message:e.$t("success"===n.status?"Permissions successfully updated":"Failed to update permissions")}),e.$store.dispatch("auth/fetch"),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](4),e.$q.notify(t.t0);case 16:e.isLoading=!1;case 17:case"end":return t.stop()}}),t,null,[[4,13]])})))()}}}),W=z,K=(s("2a5f"),s("8f8e")),X=Object($["a"])(W,O,j,!1,null,null,null),Z=X.exports;P()(X,"components",{QToolbar:E["a"],QToolbarTitle:S["a"],QSpace:F["a"],QBtn:_["a"],QCard:x["a"],QCardSection:q["a"],QList:A["a"],QItemLabel:Y["a"],QItem:V["a"],QItemSection:U["a"],QCheckbox:K["a"]});var ee={name:"PageUserAccess",meta:function(){return{title:this.$t("User Access")+" - "+this.$t("Web Console")}},breadcrumbs:function(){return["home",{text:this.$t("User Access")}]},components:{RoleList:G,PermissionList:Z},data:function(){return{selectedRole:null,permissionFetched:!1,rolesFetched:!1}},watch:{rolesFetched:function(e,t){var s=this;e!==t&&e&&this.permissionFetched&&this.$nextTick((function(){s.$store.getters["tourGuide/finishedGroups"]["user-access"]||setTimeout((function(){s.$tourGuide.open("user-access")}),350)}))},permissionFetched:function(e,t){var s=this;e!==t&&e&&this.rolesFetched&&this.$nextTick((function(){s.$store.getters["tourGuide/finishedGroups"]["user-access"]||setTimeout((function(){s.$tourGuide.open("user-access")}),350)}))}},methods:{onRoleSelected:function(e){this.selectedRole=e&&e.id||null}}},te=ee,se=(s("4749"),s("9989")),ae=Object($["a"])(te,a,n,!1,null,null,null);t["default"]=ae.exports;P()(ae,"components",{QPage:se["a"],QBtn:_["a"],QToolbarTitle:S["a"],QCard:x["a"]})},"75ca":function(e,t,s){"use strict";s("487b")},"8ed6":function(e,t,s){"use strict";s("c378")},c378:function(e,t,s){},d8f3:function(e,t,s){}}]);