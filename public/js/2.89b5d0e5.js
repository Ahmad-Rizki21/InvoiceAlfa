(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"4b2f":function(e,t,n){"use strict";n("8932")},"521c":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"page-invoices page-invoice-single page-invoice-show"},[t("portal",{attrs:{to:"app-breadcrumbs"}},[t("breadcrumbs")],1),t("portal",{attrs:{to:"app-toolbar"}},[t("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/invoices"}}),t("q-toolbar-title",[e.isCreate?[e._v("\n        "+e._s(e.$t("Create New {entity}",{entity:e.$t("Invoice")}))+"\n      ")]:[e._v("\n        "+e._s(e.$t("Invoice"))+"\n      ")]],2),t("div",{staticClass:"sep"}),e.$auth.can("create.invoice")?t("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"add"}}):e._e()],1),t("div",{staticClass:"page-header"},[t("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/invoices"}}),t("q-toolbar-title",[e.isCreate?[e._v("\n        "+e._s(e.$t("Create New {entity}",{entity:e.$t("Invoice")}))+"\n      ")]:[e._v("\n        "+e._s(e.$t("Invoice"))+"\n      ")]],2),t("div",{staticClass:"sep"}),e.isCreate&&e.formInvoice.invoice_no?t("q-btn",{staticClass:"q-btn-lg btn-page-invoices-single-settings",attrs:{flat:"",padding:"sm",icon:"settings",disable:e.isLoading},on:{click:function(t){e.isFormTemplateSettingsVisible=!0}}},[t("q-tooltip",[e._v("\n        "+e._s(e.$t("Template Settings"))+"\n      ")])],1):e._e(),e.isCreate&&e.formInvoice.invoice_no?t("q-btn",{staticClass:"q-btn-lg q-ml-sm btn-page-invoices-single-preview",attrs:{color:"default",split:"",icon:"plagiarism",disable:e.isLoading},on:{click:e.onPreview}},[e._v("\n      "+e._s(e.$t("Preview"))+"\n    ")]):!e.isCreate&&e.formInvoice.invoice_no?t("q-btn-dropdown",{staticClass:"q-btn-lg q-ml-sm btn-page-invoices-single-print",attrs:{color:"default",split:"",icon:"print",disable:e.isLoading||e.isSyncing},on:{click:e.onPrint},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",{staticClass:"q-ml-xs"},[e._v(e._s(e.$t("Print")))])]},proxy:!0}])},[t("q-list",[t("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"justify-center items-center",attrs:{clickable:"",disable:e.isSyncing},on:{click:e.onPreview}},[e._v("\n          "+e._s(e.$t("Preview"))+"\n        ")])],1)],1):e._e(),e.formInvoice.invoice_no&&e.isCreate?[t("q-btn",{staticClass:"q-btn-lg q-ml-sm btn-page-invoices-single-save",attrs:{color:"primary",icon:"check",disable:e.isLoading||e.isSyncing},on:{click:e.onSave}},[t("span",{staticClass:"q-ml-xs"},[e._v(e._s(e.$t("Save")))]),e._v("\n        "+e._s(e.isSyncing?"...":"")+"\n      ")])]:e.formInvoice.invoice_no?[e.isEditable?t("q-btn-dropdown",{staticClass:"q-btn-lg q-ml-sm btn-page-invoices-single-save",attrs:{split:"",color:"primary",icon:"check",disable:e.isLoading||e.isSyncing},on:{click:e.onSave},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",{staticClass:"q-ml-xs"},[e._v(e._s(e.$t("Save")))]),e._v("\n          "+e._s(e.isSyncing?"...":"")+"\n        ")]},proxy:!0}],null,!1,1298575039)},[t("q-list",[t("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"justify-center items-center",attrs:{clickable:"",disable:e.isSyncing},on:{click:function(t){e.isEditable=!1}}},[e._v("\n            "+e._s(e.$t("Cancel Editing"))+"\n          ")])],1)],1):t("q-btn",{staticClass:"q-btn-lg q-ml-sm btn-page-invoices-single-edit",attrs:{color:"secondary",icon:"edit",disable:e.isLoading||e.isSyncing},on:{click:function(t){e.isEditable=!0}}},[t("span",{staticClass:"q-ml-xs"},[e._v(e._s(e.$t("Edit")))]),e._v("\n        "+e._s(e.isSyncing?"...":"")+"\n      ")])]:e._e()],2),t("div",{staticClass:"page-body"},[e.isCreate?t("div",{staticClass:"row q-mb-lg"},[t("div",{staticClass:"col-xs-12"},[t("div",{staticClass:"page-action q-pa-sm q-gutter-md"},[t("div",{staticClass:"page-action-customer"},[t("div",{staticClass:"page-action-customer-inner"},[t("autocomplete-distribution-center",{directives:[{name:"show",rawName:"v-show",value:"distribution_center"===e.customerToFind,expression:"customerToFind === 'distribution_center'"}],attrs:{readonly:e.isLoading||e.isSyncing,filled:"",label:e.$t("Select {entity}",{entity:e.$t("distribution center")})},model:{value:e.entry.distribution_center_id,callback:function(t){e.$set(e.entry,"distribution_center_id",t)},expression:"entry.distribution_center_id"}}),t("autocomplete-franchise",{directives:[{name:"show",rawName:"v-show",value:"franchise"===e.customerToFind,expression:"customerToFind === 'franchise'"}],attrs:{readonly:e.isLoading||e.isSyncing,filled:"",label:e.$t("Select {entity}",{entity:e.$t("franchise")})},model:{value:e.entry.franchise_id,callback:function(t){e.$set(e.entry,"franchise_id",t)},expression:"entry.franchise_id"}}),t("q-option-group",{attrs:{options:[{label:e.$t("Distribution Center"),value:"distribution_center"},{label:e.$t("Franchise"),value:"franchise"}],color:"primary",disable:e.isSyncing,inline:""},model:{value:e.customerToFind,callback:function(t){e.customerToFind=t},expression:"customerToFind"}})],1)])])])]):e._e(),t("div",{staticClass:"row"},[t("div",{staticClass:"col-xs-12"},[e.isLoading?t("div",{staticClass:"empty-distribution-center"},[t("q-spinner",{attrs:{color:"primary",size:"3em"}})],1):e.formInvoice.invoice_no?t("div",[t("div",[t("form-invoice",{ref:"formInvoice",attrs:{entry:e.formInvoice,loading:e.isLoading,"is-create":e.isCreate,syncing:e.isSyncing,editable:e.isEditable,"template-settings":e.formTemplateSettings},on:{"update:loading":function(t){e.isLoading=t},"update:syncing":function(t){e.isSyncing=t},success:e.onSuccess,updated:e.onFormInvoiceUpdated}})],1),t("div",[t("form-receipt",{ref:"formReceipt",attrs:{entry:e.formReceipt,"is-create":e.isCreate,loading:e.isLoading,syncing:e.isSyncing,invoice:e.formInvoiceUpdated,editable:e.isEditable,"template-settings":e.formTemplateSettings},on:{"update:loading":function(t){e.isLoading=t},"update:syncing":function(t){e.isSyncing=t},success:e.onSuccess,updated:e.onFormReceiptUpdated}})],1)]):t("div",{staticClass:"empty-distribution-center"},["distribution_center"===e.customerToFind?[e._v("\n          "+e._s(e.$t("Please select a distribution center to continue"))+"\n          ")]:[e._v("\n            "+e._s(e.$t("Please select a franchise to continue"))+"\n          ")]],2)])])]),t("q-dialog",{attrs:{persistent:""},model:{value:e.isFormTemplateSettingsVisible,callback:function(t){e.isFormTemplateSettingsVisible=t},expression:"isFormTemplateSettingsVisible"}},[t("form-template-settings",{attrs:{entry:e.formTemplateSettings},on:{success:e.onFormTemplateSettingsSuccess,cancel:e.onFormTemplateSettingsCancel}})],1),t("q-dialog",{attrs:{maximized:"","full-width":"","full-height":"","transition-show":"slide-down","transition-hide":"slide-down","content-class":"dialog-print-preview"},model:{value:e.isFormPrintPreviewVisible,callback:function(t){e.isFormPrintPreviewVisible=t},expression:"isFormPrintPreviewVisible"}},[t("form-print-preview",{attrs:{invoice:e.formInvoice,"invoice-updated":e.formInvoiceUpdated,receipt:e.formReceipt,"template-settings":e.formTemplateSettings},on:{close:function(t){e.isFormPrintPreviewVisible=!1}}})],1),e.printUrl?t("iframe",{ref:"printIframe",staticStyle:{opacity:"0",visibility:"hidden",width:"0",height:"0"},attrs:{src:e.printUrl}}):e._e()],1)},s=[],a=n("ded3"),r=n.n(a),o=n("7ec2"),c=n.n(o),l=n("c973"),u=n.n(l),d=(n("14d9"),n("ac1f"),n("5319"),n("bd4c")),m=n("a8c8"),f=n("a6f8"),p=function(){var e=this,t=e._self._c;return t("q-card",{staticClass:"form-entry q-pa-sm",class:{readonly:e.readonly}},[t("q-form",{ref:"form",staticClass:"q-gutter-md",attrs:{greedy:""},on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[e.readonly?e._e():t("div",{staticClass:"text-h6 q-px-md q-pt-sm"},[e._v("\n      "+e._s(e.$t("Template Settings"))+"\n    ")]),t("q-card-section",{staticClass:"q-mb-md scroll",staticStyle:{"max-height":"56vh"}},[t("div",{staticClass:"q-mb-md text-subtitle text-weight-bold"},[e._v(e._s(e.$t("Monetary")))]),t("div",{staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12 col-sm-6 col-md-3"},[t("q-input",{attrs:{label:e.$t("Stamp Duty"),filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,dense:"","stack-label":"",name:""+e.constant.StampDuty,autocomplete:"off",rules:e.rules[e.constant.StampDuty],error:!!e.errors[e.constant.StampDuty],"error-message":e.errors[e.constant.StampDuty]},on:{keypress:function(t){return e.$globalListeners.onKeypressOnlyFloat(t)}},model:{value:e.formEntry[e.constant.StampDuty],callback:function(t){e.$set(e.formEntry,e.constant.StampDuty,t)},expression:"formEntry[constant.StampDuty]"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 col-md-3"},[t("q-input",{attrs:{label:e.$t("PPN Percentage"),filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,name:""+e.constant.PpnPercentage,"stack-label":"",suffix:"%",autocomplete:"off",dense:"",rules:e.rules[e.constant.PpnPercentage],error:!!e.errors[e.constant.PpnPercentage],"error-message":e.errors[e.constant.PpnPercentage]},on:{keypress:function(t){return e.$globalListeners.onKeypressOnlyFloat(t)}},model:{value:e.formEntry[e.constant.PpnPercentage],callback:function(t){e.$set(e.formEntry,e.constant.PpnPercentage,t)},expression:"formEntry[constant.PpnPercentage]"}})],1)]),t("div",{staticClass:"q-mb-md text-subtitle text-weight-bold"},[e._v(e._s(e.$t("Signatory")))]),t("div",{staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12 col-sm-6 col-md-4"},[t("q-input",{attrs:{label:e.$t("Signatory Name")+"*",filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,dense:"",name:""+e.constant.SignatoryName,"stack-label":"",autocomplete:"off",rules:e.rules[e.constant.SignatoryName],error:!!e.errors[e.constant.SignatoryName],"error-message":e.errors[e.constant.SignatoryName]},model:{value:e.formEntry[e.constant.SignatoryName],callback:function(t){e.$set(e.formEntry,e.constant.SignatoryName,t)},expression:"formEntry[constant.SignatoryName]"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 col-md-4"},[t("q-input",{attrs:{label:e.$t("Signatory Position")+"*",filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,name:""+e.constant.SignatoryPosition,"stack-label":"",autocomplete:"off",dense:"",rules:e.rules[e.constant.SignatoryPosition],error:!!e.errors[e.constant.SignatoryPosition],"error-message":e.errors[e.constant.SignatoryPosition]},model:{value:e.formEntry[e.constant.SignatoryPosition],callback:function(t){e.$set(e.formEntry,e.constant.SignatoryPosition,t)},expression:"formEntry[constant.SignatoryPosition]"}})],1)]),t("div",{staticClass:"q-mb-md text-subtitle text-weight-bold"},[e._v(e._s(e.$t("Bank Transfer")))]),t("div",{staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12 col-sm-6 col-md-9"},[t("q-input",{attrs:{label:e.$t("Bank Name")+"*",filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,dense:"",name:""+e.constant.BankTransferName,"stack-label":"",autocomplete:"off",rules:e.rules[e.constant.BankTransferName],error:!!e.errors[e.constant.BankTransferName],"error-message":e.errors[e.constant.BankTransferName]},model:{value:e.formEntry[e.constant.BankTransferName],callback:function(t){e.$set(e.formEntry,e.constant.BankTransferName,t)},expression:"formEntry[constant.BankTransferName]"}})],1)]),t("div",{staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12 col-sm-6 col-md-4"},[t("q-input",{attrs:{label:e.$t("Account Number")+"*",filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,name:""+e.constant.BankTransferAccountNumber,"stack-label":"",autocomplete:"off",dense:"",rules:e.rules[e.constant.BankTransferAccountNumber],error:!!e.errors[e.constant.BankTransferAccountNumber],"error-message":e.errors[e.constant.BankTransferAccountNumber]},model:{value:e.formEntry[e.constant.BankTransferAccountNumber],callback:function(t){e.$set(e.formEntry,e.constant.BankTransferAccountNumber,t)},expression:"formEntry[constant.BankTransferAccountNumber]"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 col-md-5"},[t("q-input",{attrs:{label:e.$t("Account Name")+"*",filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,name:""+e.constant.BankTransferAccountName,"stack-label":"",autocomplete:"off",dense:"",rules:e.rules[e.constant.BankTransferAccountName],error:!!e.errors[e.constant.BankTransferAccountName],"error-message":e.errors[e.constant.BankTransferAccountName]},model:{value:e.formEntry[e.constant.BankTransferAccountName],callback:function(t){e.$set(e.formEntry,e.constant.BankTransferAccountName,t)},expression:"formEntry[constant.BankTransferAccountName]"}})],1)]),t("div",{staticClass:"q-mb-md text-subtitle text-weight-bold"},[e._v(e._s(e.$t("Misc")))]),t("div",{staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12 col-md-8"},[t("text-editor",{attrs:{label:e.$t("Invoice Note"),filled:!e.readonly,borderless:e.readonly,readonly:e.readonly,dense:"",name:""+e.constant.InvoiceNote,"stack-label":"",autocomplete:"off",rules:e.rules[e.constant.InvoiceNote],error:!!e.errors[e.constant.InvoiceNote],"error-message":e.errors[e.constant.InvoiceNote]},model:{value:e.formEntry[e.constant.InvoiceNote],callback:function(t){e.$set(e.formEntry,e.constant.InvoiceNote,t)},expression:"formEntry[constant.InvoiceNote]"}})],1)])]),t("q-separator"),e.readonly?t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{attrs:{label:e.$t("Close"),flat:"",disable:e.loading||e.isLoading},on:{click:e.cancel}})],1):t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{attrs:{label:e.$t("Cancel"),flat:"",disable:e.loading||e.isLoading},on:{click:e.cancel}}),t("q-btn",{staticClass:"q-px-lg",attrs:{type:"submit",label:e.$t("".concat(e.isCreate?"Create":"Save")),color:e.isCreate?"positive":"primary",loading:e.loading||e.isLoading,unelevated:""}})],1)],1)],1)},v=[],g=n("9523"),b=n.n(g),y=(n("cb29"),n("00b4"),n("99af"),{name:"FormEntry",props:{loading:Boolean,closable:{type:Boolean,default:!0},entry:{type:Object,default:function(){return this.generateDefaultFormEntry()}},readonly:{type:Boolean,default:!1}},data:function(){var e=this;return{formEntry:this.generateDefaultFormEntry(),isLoading:!1,rules:{terminal_name:[function(t){return!!t||e.$t("{field} is required",{field:e.$t("Terminal name")})}],location:[function(t){return!!t||e.$t("{field} is required",{field:e.$t("Location")})}],online_at:[function(t){return!t||!!t&&e.$utils.isDateValid(t)||e.$t("{field} is invalid",{field:e.$t("Online at")})}],latitude:[],longitude:[],pic_name:[],pic_phone_number:[],sla:[]},errors:this.generateDefaultFormEntry()}},computed:{isCreate:function(){return!this.formEntry.id},constant:function(){return this.$constant.setting_key||{InvoiceNote:3}}},watch:{entry:{immediate:!0,handler:function(e){var t=this;this.$nextTick((function(){t.fill(e)}))}}},methods:{generateDefaultFormEntry:function(){var e,t=this.constant||{};return e={},b()(e,t.BankTransferAccountName,null),b()(e,t.BankTransferAccountNumber,null),b()(e,t.BankTransferName,null),b()(e,t.InvoiceNote||3,""),b()(e,t.PpnPercentage,null),b()(e,t.SignatoryName,null),b()(e,t.SignatoryPosition,null),b()(e,t.StampDuty,null),e},fill:function(e){e=r()(r()({},this.generateDefaultFormEntry()),e),e[this.constant.InvoiceNote||3]=e[this.constant.InvoiceNote||3]||"",this.formEntry=e,this.$refs.form.resetValidation()},onSubmit:function(){var e=this;return u()(c()().mark((function t(){var n,i,s,a;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loading&&!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:if(!e.readonly){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$refs.form.validate();case 6:if(n=t.sent,n){t.next=9;break}return t.abrupt("return");case 9:return i=r()({},e.formEntry),e.isLoading=!0,t.prev=11,t.next=14,e.$api.post("/v1/settings",i);case 14:s=t.sent,a=s.data,"success"===a.status&&e.$emit("success",a.data.settings),a.message?e.$q.notify({message:a.message}):"success"===a.status?e.$q.notify({message:e.$t("{entity} saved",{entity:e.$t("Settings")})}):e.$t("Failed to save {entity}",{entity:e.$t("settings")}),t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](11),t.t0.validation?e.errors=r()(r()({},e.generateDefaultFormEntry()),t.t0.validation.errors):e.$q.notify(t.t0);case 23:e.isLoading=!1;case 24:case"end":return t.stop()}}),t,null,[[11,20]])})))()},cancel:function(){this.loading||this.isLoading||this.$emit("cancel")},onDoubleInputChildKeydown:function(e){var t=String(e.target.value).replace(/[^0-9]/g,""),n=/^[0-9]$/i.test(e.key);n&&(t="".concat(t).concat(e.key)),(t>59||String(t).length>2)&&n&&e.preventDefault()}}}),_=y,h=(n("4b2f"),n("2877")),$=n("f09f"),S=n("0378"),k=n("a370"),C=n("27f9"),q=n("eb85"),x=n("4b7e"),w=n("9c40"),T=n("eebe"),I=n.n(T),P=Object(h["a"])(_,p,v,!1,null,"210f3dbb",null),N=P.exports;I()(P,"components",{QCard:$["a"],QForm:S["a"],QCardSection:k["a"],QInput:C["a"],QSeparator:q["a"],QCardActions:x["a"],QBtn:w["a"]});var F=n("602a"),E={name:"PageInvoiceShow",components:{FormInvoice:m["a"],FormReceipt:f["a"],FormTemplateSettings:N,FormPrintPreview:F["a"]},meta:function(){var e=this.$t("Create New {entity}",{entity:this.$t("Invoice")});return this.isCreate||(e=this.$t("Invoice")),{title:e+" - "+this.$t("Web Console")}},breadcrumbs:function(){var e=["home",{text:this.$t("Invoices"),to:"/invoices"}];return this.isCreate?e.push({text:this.$t("New {entity}",{entity:this.$t("Invoice")})}):this.formInvoice&&this.formInvoice.invoice_no&&e.push({text:this.formInvoice.invoice_no}),e},data:function(){return{isSyncing:!1,isLoading:!1,isFormTemplateSettingsVisible:!1,isFormPrintPreviewVisible:!1,entry:{distribution_center_id:null,franchise_id:null},formInvoice:{invoice_no:null},formReceipt:{receipt_no:null},formInvoiceUpdated:{},formTemplateSettings:{},customerToFind:"distribution_center",isEditable:!0,printUrl:null}},computed:{isCreate:function(){return!this.$route.params.id}},watch:{"entry.distribution_center_id":function(e,t){e!==t&&this.rebuildInvoice()},"entry.franchise_id":function(e,t){e!==t&&this.rebuildInvoice()}},created:function(){this.requestSettings(),this.isCreate||this.requestInvoice()},mounted:function(){this.isCreate||(this.isEditable=!1)},beforeRouteEnter:function(e,t,n){n((function(e){e.isCreate||(e.isEditable=!1)}))},methods:{requestInvoice:function(){var e=this;return u()(c()().mark((function t(){var n,i,s;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:return e.isLoading=!0,n={edit:1,includes:"invoiceServices"},t.prev=4,t.next=7,e.$api.get("/v1/invoices/".concat(e.$route.params.id),{params:n});case 7:i=t.sent,s=i.data,"success"===s.status&&(e.formInvoice=s.data.invoice,e.formReceipt=s.data.invoice),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](4),e.$q.notify(t.t0);case 15:e.isLoading=!1;case 16:case"end":return t.stop()}}),t,null,[[4,12]])})))()},requestSettings:function(){var e=this;return u()(c()().mark((function t(){var n,i;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.get("/v1/settings");case 3:n=t.sent,i=n.data,"success"===i.status&&(e.formTemplateSettings=i.data.settings),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$q.notify(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},rebuildInvoice:function(){var e=this;return u()(c()().mark((function t(){var n,i,s;return c()().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isCreate&&!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:return e.isLoading=!0,n=e.entry,t.prev=4,t.next=7,e.$api.get("/v1/invoices/template",{params:n});case 7:i=t.sent,s=i.data,"success"===s.status&&(e.formInvoice=s.data.invoice,e.formReceipt=s.data.invoice),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](4),e.$q.notify(t.t0);case 15:e.isLoading=!1;case 16:case"end":return t.stop()}}),t,null,[[4,12]])})))()},onSuccess:function(e){this.isCreate&&this.$router.push("/invoices/".concat(e.id))},onPrint:function(){var e=this;this.isFormPrintPreviewVisible=!1,this.printUrl=this.$router.resolve("/invoices/".concat(this.$route.params.id,"/print")).href,this.$nextTick((function(){if(e.$refs.printIframe){var t=e.$refs.printIframe,n=t.contentWindow;n.doPrinting=!0,n.doPrint=function(){e.printUrl=null}}}))},onPreview:function(){this.isFormPrintPreviewVisible=!0},formatDateBeforeSubmit:function(e){if(e)return d["b"].formatDate(d["b"].extractDate(e,"DD/MM/YYYY"),"YYYY-MM-DD")},onSave:function(){var e=arguments,t=this;return u()(c()().mark((function n(){var i,s,a,o,l,d,m,f,p,v,g;return c()().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.length>0&&void 0!==e[0]?e[0]:{},s=!0,n.next=4,t.$refs.formInvoice.validate();case 4:return a=n.sent,"string"===typeof a&&(t.$q.notify({message:a}),s=!1),n.next=8,t.$refs.formReceipt.validate();case 8:if(o=n.sent,s&&"string"===typeof o&&(t.$q.notify({message:o}),s=!1),s){n.next=12;break}return n.abrupt("return");case 12:if(!t.isLoading){n.next=14;break}return n.abrupt("return");case 14:return l=r()({},t.formInvoiceUpdated),d={distribution_center_id:l.distribution_center_id,franchise_id:l.franchise_id,published_at:t.formatDateBeforeSubmit(l.published_at),offering_letter_reference_number:l.offering_letter_reference_number,fo_offering_letter_reference_number:l.fo_offering_letter_reference_number,approval_date:t.formatDateBeforeSubmit(l.approval_date),fo_approval_date:t.formatDateBeforeSubmit(l.fo_approval_date),issuance_number:l.issuance_number,fo_issuance_number:l.fo_issuance_number,sub_total:l.sub_total,ppn_percentage:l.ppn_percentage,ppn_total:l.ppn_total||l.ppn,stamp_duty:l.stamp_duty?parseFloat(l.stamp_duty,10)||0:null,total:l.total||l.grand_total,due_at:t.formatDateBeforeSubmit(l.due_at),note:l.note,signatory_name:l.signatory_name,signatory_position:l.signatory_position,customer_name:l.customer_name,customer_address:l.customer_address,receipt_remark:t.formReceipt.receipt_remark,invoice_services:l.services||[]},m={},i&&i.force&&(m.force=1),t.isLoading=!0,n.prev=19,f=t.isCreate?"/v1/invoices":"/v1/invoices/".concat(t.$route.params.id),p=t.isCreate?"post":"patch",n.next=24,t.$api[p](f,d,{params:m});case 24:v=n.sent,g=v.data,"success"===g.status&&(t.isCreate?t.$router.replace("/invoices/".concat(g.data.invoice.id)):(t.formInvoiceUpdated={},t.formInvoice={},t.formReceipt={},t.isEditable=!1),t.$emit("success",g.data.invoice)),g.message?t.$q.notify({message:g.message}):"success"===g.status?t.$q.notify({message:t.$t("{entity} saved",{entity:t.$t("Invoice")})}):t.$t("Failed to save {entity}",{entity:t.$t("invoice")}),n.next=39;break;case 30:if(n.prev=30,n.t0=n["catch"](19),!(n.t0.response&&n.t0.response.data&&n.t0.response.data&&4==n.t0.response.data.code)){n.next=38;break}return t.$q.dialog({title:t.$t("Confirm"),message:n.t0.response.data.message+". "+t.$t("Are you sure want to continue?"),cancel:{label:t.$t("Cancel"),color:"dark",flat:!0},ok:{label:t.$t("Yes"),color:"primary",unelevated:!0,flat:!0,class:"text-weight-bold"},persistent:!0}).onOk(u()(c()().mark((function e(){return c()().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.onSave({force:!0});case 2:case"end":return e.stop()}}),e)})))).onCancel((function(){t.isLoading=!1})),t.isLoading=!1,n.abrupt("return");case 38:t.$q.notify(n.t0);case 39:t.isLoading=!1,t.isCreate||t.requestInvoice();case 41:case"end":return n.stop()}}),n,null,[[19,30]])})))()},onFormInvoiceUpdated:function(e){this.formInvoiceUpdated=e},onFormReceiptUpdated:function(e){this.formReceipt=e},onFormTemplateSettingsSuccess:function(e){this.isFormTemplateSettingsVisible=!1,this.formTemplateSettings=e},onFormTemplateSettingsCancel:function(){this.isFormTemplateSettingsVisible=!1}}},B=E,L=(n("c94f"),n("9989")),D=n("6ac5"),A=n("05c0"),Q=n("f20b"),V=n("1c1c"),U=n("66e5"),R=n("9f0a"),Y=n("0d59"),O=n("24e8"),M=n("7f67"),j=Object(h["a"])(B,i,s,!1,null,null,null);t["default"]=j.exports;I()(j,"components",{QPage:L["a"],QBtn:w["a"],QToolbarTitle:D["a"],QTooltip:A["a"],QBtnDropdown:Q["a"],QList:V["a"],QItem:U["a"],QOptionGroup:R["a"],QSpinner:Y["a"],QDialog:O["a"]}),I()(j,"directives",{ClosePopup:M["a"]})},8932:function(e,t,n){},b444:function(e,t,n){},c94f:function(e,t,n){"use strict";n("b444")}}]);